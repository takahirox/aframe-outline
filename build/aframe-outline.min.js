!function(e){function i(a){if(t[a])return t[a].exports;var o=t[a]={exports:{},id:a,loaded:!1};return e[a].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}var t={};return i.m=e,i.c=t,i.p="",i(0)}([function(e,i,t){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register beforeAFRAME was available.");t(1),AFRAME.registerComponent("outline",{schema:{thickness:{type:"number",default:.003},color:{type:"color",default:"#000"},alpha:{type:"number",default:1}},init:function(){this.effect=null},update:function(){this.setupOutlineEffect()},setupOutlineEffect:function(){if(null===this.effect){var e=this.data,i=this.el,t=i.sceneEl,a=t.renderer,o=t.effect;if(void 0!==a&&void 0!==o){for(var r=new THREE.OutlineEffect(a,{defaultThickness:e.thickness,defaultColor:new THREE.Color(e.color),defaultAlpha:e.alpha}),n=Object.keys(a),l=0,s=n.length;l<s;l++){var u=n[l];void 0===r[u]&&(r[u]="function"==typeof a[u]?a[u].bind(a):a[u])}this.effect=r,t.effect=new THREE.VREffect(r)}}}})},function(e,i){THREE.OutlineEffect=function(e,i){function t(e){var i,t,a=k[e.type];e.outlineParameters;if(void 0!==a){var o=THREE.ShaderLib[a];i=o.uniforms,t=o.vertexShader}else{if(e.isShaderMaterial!==!0)return E;i=e.uniforms,t=e.vertexShader}var r=Object.assign({},i,M),n=t.replace(/void\s+main\s*\(\s*\)/,T+"\nvoid main()").replace(/\}\s*$/,A+"\n}").replace(/#include\s+<[\w_]*light[\w_]*>/g,""),l=new THREE.ShaderMaterial({uniforms:r,vertexShader:n,fragmentShader:R,side:THREE.BackSide,skinning:!1,morphTargets:!1,morphNormals:!1,fog:!1});return l}function a(e){for(var i=[],a=0,o=e.materials.length;a<o;a++)i.push(t(e.materials[a]));return new THREE.MultiMaterial(i)}function o(e){if(void 0!==e.material){var i=m[e.material.uuid];void 0===i&&(i={material:e.material.isMultiMaterial===!0?a(e.material):t(e.material),used:!0,keepAlive:h,count:0},m[e.material.uuid]=i);var o=i.material;i.used=!0;var r=o!==E?o.uuid:e.uuid;if(b[r]=e.material,e.material.isMultiMaterial===!0){for(var l=0,d=e.material.materials.length;l<d;l++)o.materials[l]!==E&&(b[o.materials[l].uuid]=e.material.materials[l]);u(o,e.material)}else s(o,e.material);e.material=o,g[e.uuid]=e.onBeforeRender,e.onBeforeRender=n}}function r(e){if(void 0!==e.material){var i=b[e.material.uuid];void 0===i&&(i=b[e.uuid],void 0===i)||(e.material=i,e.onBeforeRender=g[e.uuid])}}function n(e,i,t,a,o,r){if(o!==E&&o.isMultiMaterial!==!0){var n=b[o.uuid];void 0!==n&&l(o,n)}}function l(e,i){var t=i.outlineParameters;e.uniforms.outlineAlpha.value=i.opacity,void 0!==t&&(void 0!==t.thickness&&(e.uniforms.outlineThickness.value=t.thickness),void 0!==t.color&&e.uniforms.outlineColor.value.copy(t.color),void 0!==t.alpha&&(e.uniforms.outlineAlpha.value=t.alpha))}function s(e,i){if(e!==E){var t=i.outlineParameters;e.skinning=i.skinning,e.morphTargets=i.morphTargets,e.morphNormals=i.morphNormals,e.fog=i.fog,void 0!==t?(i.visible===!1?e.visible=!1:e.visible=void 0===t.visible||t.visible,e.transparent=void 0!==t.alpha&&t.alpha<1||i.transparent,void 0!==t.keepAlive&&void 0!==m[i.uuid]&&(m[i.uuid].keepAlive=t.keepAlive)):(e.transparent=i.transparent,e.visible=i.visible),i.wireframe!==!0&&i.depthTest!==!1||(e.visible=!1)}}function u(e,i){if(e!==E){var t=i.outlineParameters;void 0!==t?(i.visible===!1?e.visible=!1:e.visible=void 0===t.visible||t.visible,void 0!==t.keepAlive&&(m[i.uuid].keepAlive=t.keepAlive)):e.visible=i.visible;for(var a=0,o=e.materials.length;a<o;a++)s(e.materials[a],i.materials[a])}}function d(){var e;e=Object.keys(b);for(var i=0,t=e.length;i<t;i++)b[e[i]]=void 0;e=Object.keys(g);for(var i=0,t=e.length;i<t;i++)g[e[i]]=void 0;e=Object.keys(m);for(var i=0,t=e.length;i<t;i++){var a=e[i];m[a].used===!1?(m[a].count++,m[a].keepAlive===!1&&m[a].count>p&&delete m[a]):(m[a].used=!1,m[a].count=0)}}i=i||{},this.enabled=!0;var f=void 0!==i.defaultThickness?i.defaultThickness:.003,c=void 0!==i.defaultColor?i.defaultColor:new THREE.Color(0),v=void 0!==i.defaultAlpha?i.defaultAlpha:1,h=void 0!==i.defaultKeepAlive&&i.defaultKeepAlive,m={},p=60,b={},g={},E=new THREE.ShaderMaterial({visible:!1}),k={MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical"},M={outlineThickness:{type:"f",value:f},outlineColor:{type:"c",value:c},outlineAlpha:{type:"f",value:v}},T=["uniform float outlineThickness;","vec4 calculateOutline( vec4 pos, vec3 objectNormal, vec4 skinned ) {","\tfloat thickness = outlineThickness;","\tfloat ratio = 1.0;","\tvec4 pos2 = projectionMatrix * modelViewMatrix * vec4( skinned.xyz + objectNormal, 1.0 );","\tvec4 norm = normalize( pos - pos2 );","\treturn pos + norm * thickness * pos.w * ratio;","}"].join("\n"),A=["#if ! defined( LAMBERT ) && ! defined( PHONG ) && ! defined( TOON ) && ! defined( PHYSICAL )","\t#ifndef USE_ENVMAP","\t\tvec3 objectNormal = normalize( normal );","\t\t#ifdef FLIP_SIDED","\t\t\tobjectNormal = -objectNormal;","\t\t#endif","\t#endif","#endif","#ifdef USE_SKINNING","\tgl_Position = calculateOutline( gl_Position, objectNormal, skinned );","#else","\tgl_Position = calculateOutline( gl_Position, objectNormal, vec4( transformed, 1.0 ) );","#endif"].join("\n"),R=["#include <common>","#include <fog_pars_fragment>","uniform vec3 outlineColor;","uniform float outlineAlpha;","void main() {","\tgl_FragColor = vec4( outlineColor, outlineAlpha );","\t#include <fog_fragment>","}"].join("\n");this.render=function(i,t,a,n){if(this.enabled===!1)return void e.render(i,t,a,n);var l=e.autoClear;e.autoClear=this.autoClear,e.render(i,t,a,n);var s=i.autoUpdate,u=i.background,f=e.shadowMap.enabled;i.autoUpdate=!1,i.background=null,e.autoClear=!1,e.shadowMap.enabled=!1,i.traverse(o),e.render(i,t,a),i.traverse(r),d(),i.autoUpdate=s,i.background=u,e.autoClear=l,e.shadowMap.enabled=f},this.autoClear=e.autoClear,this.domElement=e.domElement,this.shadowMap=e.shadowMap,this.clear=function(i,t,a){e.clear(i,t,a)},this.getPixelRatio=function(){return e.getPixelRatio()},this.setPixelRatio=function(i){e.setPixelRatio(i)},this.getSize=function(){return e.getSize()},this.setSize=function(i,t,a){e.setSize(i,t,a)},this.setViewport=function(i,t,a,o){e.setViewport(i,t,a,o)},this.setScissor=function(i,t,a,o){e.setScissor(i,t,a,o)},this.setScissorTest=function(i){e.setScissorTest(i)},this.setRenderTarget=function(i){e.setRenderTarget(i)}}}]);